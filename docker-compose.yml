services:
  app:
    build:
      context: .
    pull_policy: never
    read_only: true
    tmpfs:
      - /tmp
    cap_drop:
      - ALL
    security_opt:
      - no-new-privileges:true
    networks:
      - internal
    expose:
      - "3000"
    restart: unless-stopped

  cloudflared:
    image: ${CLOUDFLARED_IMAGE:-cloudflare/cloudflared:latest}
    command: tunnel --no-autoupdate run --token ${CLOUDFLARED_TOKEN}
    depends_on:
      - app
    read_only: true
    tmpfs:
      - /tmp
    cap_drop:
      - ALL
    security_opt:
      - no-new-privileges:true
    networks:
      - internal
      - default
    restart: unless-stopped

networks:
  internal:
    internal: true
